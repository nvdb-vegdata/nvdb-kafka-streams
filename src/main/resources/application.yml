spring:
  application:
    name: kafka-at-home

  datasource:
    url: jdbc:sqlite:${SQLITE_DB_PATH:./data/kafka-at-home.db}
    driver-class-name: org.sqlite.JDBC
  sql:
    init:
      mode: always

  kafka:
    bootstrap-servers: ${KAFKA_BOOTSTRAP_SERVERS:localhost:9092}
    producer:
      key-serializer: org.apache.kafka.common.serialization.StringSerializer
      value-serializer: no.vegvesen.nvdb.kafka.serialization.KotlinxJsonSerializer
      acks: all
      retries: 3
    consumer:
      key-deserializer: org.apache.kafka.common.serialization.StringDeserializer
      value-deserializer: org.apache.kafka.common.serialization.StringDeserializer
      group-id: kafka-at-home-consumer
      auto-offset-reset: earliest
    streams:
      bootstrap-servers: ${KAFKA_BOOTSTRAP_SERVERS:localhost:9092}
      application-id: kafka-at-home-streams
      properties:
        default.key.serde: org.apache.kafka.common.serialization.Serdes$StringSerde
        default.value.serde: org.apache.kafka.common.serialization.Serdes$StringSerde

# Kafka Topics Configuration
kafka:
  topics:
    partitions: ${KAFKA_TOPIC_PARTITIONS:5}
    replicas: ${KAFKA_TOPIC_REPLICAS:1}
    readiness:
      enabled: ${KAFKA_TOPICS_READINESS_ENABLED:true}
      timeout-seconds: ${KAFKA_TOPICS_READINESS_TIMEOUT:60}
      max-retries: ${KAFKA_TOPICS_READINESS_MAX_RETRIES:20}
      initial-retry-delay-ms: ${KAFKA_TOPICS_READINESS_INITIAL_DELAY:100}
      max-retry-delay-ms: ${KAFKA_TOPICS_READINESS_MAX_DELAY:5000}
      fail-on-startup-timeout: ${KAFKA_TOPICS_FAIL_ON_TIMEOUT:true}

# NVDB API Configuration
nvdb:
  api:
    base-url: ${NVDB_API_BASE_URL:https://nvdbapiles.atlas.vegvesen.no/uberiket/api/v1/}
  producer:
    enabled: ${NVDB_PRODUCER_ENABLED:true}
    backfill:
      batch-size: ${NVDB_BACKFILL_BATCH_SIZE:100}
    updates:
      batch-size: ${NVDB_UPDATES_BATCH_SIZE:100}
    schedule:
      type915: ${NVDB_SCHEDULE_TYPE915:60000}  # 1 minute
      type916: ${NVDB_SCHEDULE_TYPE916:60000}  # 1 minute

# Logging Configuration
logging:
  level:
    root: INFO
    no.vegvesen.nvdb.kafka: DEBUG
    org.apache.kafka: WARN
    org.springframework.kafka: INFO

# Server Configuration
server:
  port: ${SERVER_PORT:8080}

# Management/Actuator endpoints
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,kafka
  endpoint:
    health:
      show-details: always
  health:
    kafka-topics:
      enabled: ${KAFKA_TOPICS_HEALTH_ENABLED:true}

# SpringDoc OpenAPI Configuration
springdoc:
  api-docs:
    path: /api-docs
  swagger-ui:
    path: /swagger-ui.html
    operations-sorter: alpha
    tags-sorter: alpha
  info:
    title: NVDB Kafka Producer API
    description: REST API for managing NVDB data ingestion with backfill and updates modes
    version: 1.0.0
